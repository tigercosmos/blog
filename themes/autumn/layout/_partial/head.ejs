<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta name="keywords"
        content="<% if (page.tags) { %><% page.tags.forEach(function (tag) { %><% if (tag.name && tag.name.trim()) { %><%= tag.name %>,<% } else if (tag) { %><%= tag %>,<% } %><% }) %><% } else { %><%- theme.keywords %><% } %>" />
    <meta name="description"
        content="<% if (page.des) {%><%= page.des %><% } else if (page.title) {%><%= page.title %><% }else { %><%= config.description %><% } %>" />
    <title><%= config.title %><% if (page.title){%>: <%= page.title %> <%}%></title>
    <% const configuredLangs = (function () {
        if (Array.isArray(config.language)) return config.language;
        if (typeof config.language === 'string') return config.language.split(',').map(function (s) { return s.trim(); }).filter(Boolean);
        if (typeof config.language === 'undefined' || config.language === null) return [];
        return [String(config.language)];
    })(); %>
    <% const defaultLang = configuredLangs[0] || 'en'; %>
    <% const hreflangLangs = configuredLangs.filter(function (lang) { return lang && lang !== 'default'; }); %>
    <% const pageLang = page.lang || defaultLang; %>
    <% const translationEntries = translation_entries(page); %>
    <% if (translationEntries.length > 1) { %>
        <% translationEntries.forEach(function (entry) { %>
            <link rel="alternate" hreflang="<%= entry.lang %>" href="<%= entry.abs %>">
        <% }) %>
        <% const defaultEntry = translationEntries.find(function (entry) { return entry.isDefault; }) || translationEntries[0]; %>
        <link rel="alternate" hreflang="x-default" href="<%= defaultEntry.abs %>">
    <% } else if (page.__index || page.archive || page.tag) { %>
        <% const base = (config.url || '').replace(/\/$/, ''); %>
        <% const currentUrlRaw = (typeof page.current_url === 'string') ? page.current_url : (page.path || ''); %>
        <% const currentUrl = String(currentUrlRaw).replace(/^\/+/, ''); %>
        <% let rel = currentUrl; %>
        <% if (pageLang !== defaultLang && rel.startsWith(pageLang + '/')) rel = rel.slice(pageLang.length + 1); %>
        <% hreflangLangs.forEach(function (lang) { %>
            <% if (!lang) return; %>
            <% const hrefPath = (lang === defaultLang ? '/' + rel : '/' + lang + '/' + rel).replace(/\/{2,}/g, '/'); %>
            <link rel="alternate" hreflang="<%= lang %>" href="<%= base + hrefPath %>">
        <% }) %>
        <link rel="alternate" hreflang="x-default" href="<%= base + ('/' + rel).replace(/\/{2,}/g, '/') %>">
    <% } %>
    <!-- favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <%- css('css/style.css') %>

        <!-- highlight -->
        <link id="hljs-light" rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/atom-one-light.min.css" />
        <link id="hljs-dark" rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/atom-one-dark.min.css" disabled />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>

        <script>
            // Dark mode functionality
            function toggleDarkMode() {
                const html = document.documentElement;
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                // Update toggle button
                const toggle = document.getElementById('theme-toggle');
                toggle.textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
                
                // Toggle syntax highlighting theme
                toggleSyntaxHighlighting(newTheme);
            }

            // Toggle syntax highlighting theme
            function toggleSyntaxHighlighting(theme) {
                const lightTheme = document.getElementById('hljs-light');
                const darkTheme = document.getElementById('hljs-dark');
                
                if (theme === 'dark') {
                    lightTheme.disabled = true;
                    darkTheme.disabled = false;
                } else {
                    lightTheme.disabled = false;
                    darkTheme.disabled = true;
                }
            }

            // Initialize theme on page load
            function initializeTheme() {
                const savedTheme = localStorage.getItem('theme') || 'light';
                const html = document.documentElement;
                html.setAttribute('data-theme', savedTheme);
                
                const toggle = document.getElementById('theme-toggle');
                if (toggle) {
                    toggle.textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
                }
                
                // Initialize syntax highlighting
                toggleSyntaxHighlighting(savedTheme);
            }

            window.addEventListener('DOMContentLoaded', function () {
                initializeTheme();
                const [
                    mainTitle,
                    mobileMenu,
                    mobileMainTitle,
                    mobileMenuBtn,
                    ipadMenuBtn,
                    aside,
                    closeBtn,
                ] = getEle(
                    '#main-title',
                    '.mobile-menu',
                    '.mobile-menu h3',
                    '.mobile-menu button',
                    '.ipad-menu',
                    'aside',
                    'aside .close',
                )
                const io = new IntersectionObserver(entries => {
                    if (entries[0].intersectionRatio <= 0) {
                        mobileMainTitle.classList.remove('invisibile')
                    } else {
                        mobileMainTitle.classList.add('invisibile')
                    }
                })
                io.observe(mainTitle)

                clickToggleAside(mobileMenuBtn)
                clickToggleAside(ipadMenuBtn)
                clickToggleAside(closeBtn, false)

                const isMenuVisible = window.getComputedStyle(mobileMenu).display !== 'none'
                if (isMenuVisible) document.body.style.background = 'none'

                function getEle(...args) {
                    return args.map(arg => document.querySelector(arg))
                }

                function clickToggleAside(btn, show = true) {
                    btn.addEventListener('click', function () {
                        if (show) {
                            aside.style.display = 'block'
                        } else {
                            aside.style.display = 'none'
                        }
                    })
                }
            })
        </script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-MGLC34ST00"></script>
        <script>
            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());

            gtag('config', 'G-MGLC34ST00');
        </script>
        <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async>
        </script>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
            tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
            TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
            messageStyle: "none"
        }); 

        MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

</head>
