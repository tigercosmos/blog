<!DOCTYPE html>

<html lang="en">
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta name="keywords"
        content="c++,small vector,vector,optimization," />
    <meta name="description"
        content="This post briefly introduces how to implement a Small Vector in C++." />
    <title>Neutrino&#39;s Blog: Implementing a Small Vector in C++ </title>
    
    
    
    
    
    
        
            <link rel="alternate" hreflang="zh" href="https://tigercosmos.xyz/post/2022/06/c++/smallvec/">
        
            <link rel="alternate" hreflang="en" href="https://tigercosmos.xyz/en/post/2022/06/c++/smallvec/">
        
            <link rel="alternate" hreflang="jp" href="https://tigercosmos.xyz/jp/post/2022/06/c++/smallvec/">
        
        
        <link rel="alternate" hreflang="x-default" href="https://tigercosmos.xyz/post/2022/06/c++/smallvec/">
    
    <!-- favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    
<link rel="stylesheet" href="/css/style.css">


        <!-- highlight -->
        <link id="hljs-light" rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/atom-one-light.min.css" />
        <link id="hljs-dark" rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/atom-one-dark.min.css" disabled />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>

        <script>
            // Dark mode functionality
            function toggleDarkMode() {
                const html = document.documentElement;
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                // Update toggle button
                const toggle = document.getElementById('theme-toggle');
                toggle.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                
                // Toggle syntax highlighting theme
                toggleSyntaxHighlighting(newTheme);
            }

            // Toggle syntax highlighting theme
            function toggleSyntaxHighlighting(theme) {
                const lightTheme = document.getElementById('hljs-light');
                const darkTheme = document.getElementById('hljs-dark');
                
                if (theme === 'dark') {
                    lightTheme.disabled = true;
                    darkTheme.disabled = false;
                } else {
                    lightTheme.disabled = false;
                    darkTheme.disabled = true;
                }
            }

            // Initialize theme on page load
            function initializeTheme() {
                const savedTheme = localStorage.getItem('theme') || 'light';
                const html = document.documentElement;
                html.setAttribute('data-theme', savedTheme);
                
                const toggle = document.getElementById('theme-toggle');
                if (toggle) {
                    toggle.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                }
                
                // Initialize syntax highlighting
                toggleSyntaxHighlighting(savedTheme);
            }

            window.addEventListener('DOMContentLoaded', function () {
                initializeTheme();
                const [
                    mainTitle,
                    mobileMenu,
                    mobileMainTitle,
                    mobileMenuBtn,
                    ipadMenuBtn,
                    aside,
                    closeBtn,
                ] = getEle(
                    '#main-title',
                    '.mobile-menu',
                    '.mobile-menu h3',
                    '.mobile-menu button',
                    '.ipad-menu',
                    'aside',
                    'aside .close',
                )
                const io = new IntersectionObserver(entries => {
                    if (entries[0].intersectionRatio <= 0) {
                        mobileMainTitle.classList.remove('invisibile')
                    } else {
                        mobileMainTitle.classList.add('invisibile')
                    }
                })
                io.observe(mainTitle)

                clickToggleAside(mobileMenuBtn)
                clickToggleAside(ipadMenuBtn)
                clickToggleAside(closeBtn, false)

                const isMenuVisible = window.getComputedStyle(mobileMenu).display !== 'none'
                if (isMenuVisible) document.body.style.background = 'none'

                function getEle(...args) {
                    return args.map(arg => document.querySelector(arg))
                }

                function clickToggleAside(btn, show = true) {
                    btn.addEventListener('click', function () {
                        if (show) {
                            aside.style.display = 'block'
                        } else {
                            aside.style.display = 'none'
                        }
                    })
                }
            })
        </script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-MGLC34ST00"></script>
        <script>
            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());

            gtag('config', 'G-MGLC34ST00');
        </script>
        <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async>
        </script>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
            tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
            TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
            messageStyle: "none"
        }); 

        MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Neutrino's Blog" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>


<body style="background: url(https://cdn.jsdelivr.net/gh/frontendsophie/hexo-theme-autumn@1.0.0/source/img/button-bg.png) var(--bg-color)">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container">
        <header class="header">
    <nav class="mobile-menu" style="background: url(https://cdn.jsdelivr.net/gh/frontendsophie/hexo-theme-autumn@1.0.0/source/img/button-bg.png) var(--bg-color)">
        <h3 class="invisibile">
            <a href="/en/" class="logo">
                Neutrino&#39;s Blog
            </a>
        </h3>
        <button class="menu">menu</button>
    </nav>

    <button class="ipad-menu menu">menu</button>

    <h1 class="title" id="main-title">
        <a href="/en/" class="logo">
            Neutrino&#39;s Blog
        </a>
    </h1>
    <h2 class="desc">
        Code makes the world a better place
    </h2>

    <div class="links">
        <ul>
            
            <li>
                <a href="/about">
                    About
                </a>
            </li>
            
            <li>
                <a href="/navigation">
                    Navigation
                </a>
            </li>
            
            <li>
                <a href="/books">
                    Books
                </a>
            </li>
            
            <li>
                <a href="/donation">
                    Donation
                </a>
            </li>
            
            <li>
                <a href="/message">
                    Message
                </a>
            </li>
            
            <li>
                <a href="/atom.xml">
                    RSS
                </a>
            </li>
            
            <li>
                <a href="#" id="theme-toggle" onclick="toggleDarkMode()" title="Toggle dark mode">
                    üåô
                </a>
            </li>
            
            
            <li class="translation-switcher">
                
                <button class="translation-button" type="button" aria-label="Translations" title="Translations">
                    <svg viewBox="0 0 24 24" role="img" aria-hidden="true" focusable="false">
                        <path d="M12 2a10 10 0 1 0 10 10A10.01 10.01 0 0 0 12 2Zm7.94 9h-3.15a15.46 15.46 0 0 0-1.31-5.04A8.03 8.03 0 0 1 19.94 11ZM12 4.08A13.4 13.4 0 0 1 13.89 11H10.1A13.4 13.4 0 0 1 12 4.08ZM4.06 13h3.15a15.46 15.46 0 0 0 1.31 5.04A8.03 8.03 0 0 1 4.06 13ZM7.21 11H4.06A8.03 8.03 0 0 1 8.52 5.96 15.46 15.46 0 0 0 7.21 11ZM12 19.92A13.4 13.4 0 0 1 10.1 13h3.79A13.4 13.4 0 0 1 12 19.92ZM15.48 18.04A15.46 15.46 0 0 0 16.79 13h3.15A8.03 8.03 0 0 1 15.48 18.04ZM16.79 11a15.46 15.46 0 0 0-1.31-5.04A8.03 8.03 0 0 1 19.94 11Z"></path>
                    </svg>
                    <span class="translation-current" aria-hidden="true">en</span>
                </button>
                <div class="translation-menu" aria-label="Translation menu">
                    
                        
                            <a class="translation-lang" href="/post/2022/06/c++/smallvec/" hreflang="zh" lang="zh">zh</a>
                        
                    
                        
                            <span class="translation-lang is-current" lang="en">en</span>
                        
                    
                        
                            <a class="translation-lang" href="/jp/post/2022/06/c++/smallvec/" hreflang="jp" lang="jp">jp</a>
                        
                    
                </div>
            </li>
            
        </ul>
    </div>
</header>

        <main class="main">
            <article class="post">
    
    
    
    <h2 class="post-title">
        Implementing a Small Vector in C++
    </h2>
    <ul class="post-date">
        <li>
            2022-06-22
        </li>
        <li>
            Liu, An-Chi ÂäâÂÆâÈΩä
        </li>
        
        
        <li class="post-languages">
            <span class="post-languages-label">Lang</span>
            
                
                    <a class="translation-lang" href="/post/2022/06/c++/smallvec/" hreflang="zh" lang="zh">zh</a>
                
                ,
            
                
                    <span class="translation-lang is-current" lang="en">en</span>
                
                ,
            
                
                    <a class="translation-lang" href="/jp/post/2022/06/c++/smallvec/" hreflang="jp" lang="jp">jp</a>
                
                
            
            <span class="post-languages-note">
                (original ZH, translation powered by AI)
            </span>
        </li>
        
    </ul>
    <div class="post-content">
        <p><code>std::vector</code> is probably the most frequently used container in C++. Chandler Carruth also mentioned in his talk ‚Äú<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=fHNmRkzxHWs">Efficiency with Algorithms, Performance with Data Structures (2014)</a>‚Äù that in the vast majority of cases, we basically only need to consider using <code>std::vector</code>. The reason is that even though <code>std::unordered_map</code> seems to have $O(1)$ complexity, in practice‚Äîconsidering memory access patterns and cache misses‚Äîit may not be as good as the contiguous memory layout of <code>std::vector</code>. For convenience, I will use ‚ÄúVector‚Äù to refer to <code>std::vector</code> in the rest of this post.</p>
<p>When using Vector, if we roughly know the upper bound on the number of elements, we can call <code>reserve()</code> to pre-allocate heap memory. This avoids repeated allocations and copies when the container grows. However, we still cannot avoid the first heap allocation: as long as you allocate once, the allocation cost can slow things down.</p>
<p>In fact, in many situations when we use Vector, the number of elements is often no more than 10. If we know ahead of time that the Vector will store only a small number of elements, we should be able to avoid allocating heap memory by using inline storage. In other words, we let the object itself own a buffer on the stack, so we can use it directly without extra allocations. This is called Small Object Optimization, and the idea is essentially the same as Small String Optimization (you can refer to my previous <a href="/post/2022/06/c++/sso/">post</a>).</p>
<p>You may ask: if we only want a small number of elements, why not just declare an array? Because we also want the convenience of the Vector API, such as <code>push_back()</code>. Therefore, specialized ‚ÄúSmall Vector‚Äù implementations for small element counts are commonly found in many large projects. In the past, I did not understand why people would implement a Small Vector instead of using Vector directly. The reason is simple: we want performance, and we want it to be even faster!</p>
<h2 id="A-Simple-Small-Vector"><a class="header-anchor" href="#A-Simple-Small-Vector">¬∂ </a>A Simple Small Vector</h2>
<p>Let‚Äôs implement the simplest version of Small Vector first. It only includes a basic constructor and the <code>push_back</code> function.</p>
<pre><code class="language-cpp">template &lt;typename T, size_t N = 10&gt;
class SmallVec
&#123;
public:

    explicit SmallVec(size_t size) : m_size(size)
    &#123;
        if (size &gt; N)
        &#123;
            m_capacity = m_size;
            m_head = new T[m_capacity];
        &#125;
        else
        &#123;
            m_capacity = N;
            m_head = m_data.data();
        &#125;
    &#125;

    void push_back(T const &amp; value)
    &#123;
        if (m_capacity == m_size)
        &#123;
            m_capacity *= 2;
            T *tmp = new T[m_capacity];
            std::copy_n(m_head, m_size, tmp);
            if (m_head != m_data.data())
            &#123;
                delete[] m_head;
            &#125;
            m_head = tmp;
        &#125;
        m_head[m_size++] = value;
    &#125;

private:
    T *m_head = nullptr;
    size_t m_size = 0;
    size_t m_capacity = N;
    std::array&lt;T, N&gt; m_data;
&#125;;
</code></pre>
<p>If the number of elements is less than <code>N</code>, we can store them in <code>m_data</code> owned by <code>SmallVec</code> itself, saving the cost of one heap allocation. This approach is effective. We can benchmark it with <a target="_blank" rel="noopener" href="https://quick-bench.com/">Quick C++ Benchmark</a> using the following code:</p>
<pre><code class="language-cpp">int K = 10; // does not exceed Small Vector's N

static void SmallVector(benchmark::State&amp; state) &#123;
  for (auto _ : state) &#123;
    SmallVec&lt;int&gt; sv(0); // use inline memory
    for(int i = 0 ; i &lt; K; i++) &#123;
        sv.push_back(i);
    &#125;
  &#125;
&#125;
BENCHMARK(SmallVector);


static void StdVector(benchmark::State&amp; state) &#123;
  for (auto _ : state) &#123;
    std::vector&lt;int&gt; v;
    v.reserve(K); // allocate new heap memory
    for(int i = 0 ; i &lt; K; i++) &#123;
        v.push_back(i);
    &#125;
  &#125;
&#125;
BENCHMARK(StdVector);
</code></pre>
<p>On a 64-bit environment (i3-10100, GCC 11.2), we get the following result (lower is better). It confirms that Small Vector is indeed more efficient than Vector for a small number of elements‚Äîabout 2.6x faster‚Äîmainly because Vector spends extra time allocating heap memory.</p>
<p><img src="https://user-images.githubusercontent.com/18013815/174789476-7c2693bd-55b1-47cd-a588-2be5c36d8dbc.png" alt="comparison between small vector and std vector"></p>
<blockquote>
<p>For Small Vector performance analysis, Yang Zhixuan provides a <a target="_blank" rel="noopener" href="https://hackmd.io/@25077667/r1uUxVY59">more detailed discussion</a> if you are interested.</p>
</blockquote>
<h2 id="A-Full-Small-Vector-Implementation"><a class="header-anchor" href="#A-Full-Small-Vector-Implementation">¬∂ </a>A Full Small Vector Implementation</h2>
<p>The simple Small Vector already demonstrates better performance, so I went ahead and implemented a more complete Small Vector for practice.</p>
<p>You can view the full code by expanding it at the end of this post, or download it from this <a target="_blank" rel="noopener" href="https://gist.github.com/tigercosmos/4d939e90a350071424567b8ed4d9a378">Gist</a>.</p>
<p>To briefly explain the code: if the number of elements is less than the default inline capacity <code>N</code>, it uses the built-in <code>std::array</code>. If it exceeds <code>N</code>, it allocates new memory via <code>new</code>. The more subtle part is handling <code>m_head</code> during copy operations and move semantics. Also, the Small Vector implemented here is only suitable for basic types (<code>int</code>, <code>float</code>, etc.), which matches common usage scenarios for Small Vector.</p>
<details>
<pre><code class="language-cpp">#include &lt;array&gt;
#include &lt;stdexcept&gt;
#include &lt;algorithm&gt;
#include &lt;vector&gt;
#include &lt;iostream&gt;
#include &lt;initializer_list&gt;

template &lt;typename T, size_t N = 10&gt;
class SmallVec
&#123;
public:
    using value_type = T;
    using iterator = T *;
    using const_iterator = T *const;

    SmallVec() = default;

    explicit SmallVec(size_t size) : m_size(size)
    &#123;
        if (size &gt; N)
        &#123;
            m_capacity = m_size;
            m_head = new T[m_capacity];
        &#125;
        else
        &#123;
            m_capacity = N;
            m_head = m_data.data();
        &#125;
    &#125;

    SmallVec(SmallVec const &amp;other) : m_size(other.m_size)
    &#123;
        if (other.m_head == other.m_data.data())
        &#123;
            m_capacity = N;
            m_head = m_data.data();
        &#125;
        else
        &#123;
            m_capacity = m_size;
            m_head = new T[m_capacity];
        &#125;

        std::copy_n(other.m_head, m_size, m_head);
    &#125;

    SmallVec(SmallVec &amp;&amp;other) noexcept : m_size(other.m_size)
    &#123;
        if (m_head == other.m_data.data())
        &#123;
            m_capacity = other.m_capacity;
            m_head = m_data.data();
            std::copy_n(other.m_head, m_size, m_head);
        &#125;
        else
        &#123;
            m_capacity = m_size;
            m_head = other.m_head;

            other.m_capacity = N;
            other.m_size = 0;
            other.m_head = other.m_data.data();
        &#125;

        std::copy_n(other.m_head, m_size, m_head);
    &#125;

    SmallVec(std::initializer_list&lt;T&gt; init_list)
    &#123;
        m_size = init_list.size();
        if (m_size &gt; N)
        &#123;
            m_capacity = m_size;
            m_head = new T[m_capacity];
        &#125;
        else
        &#123;
            m_capacity = N;
            m_head = m_data.data();
        &#125;
        std::copy_n(init_list.begin(), m_size, m_head);
    &#125;

    SmallVec &amp;operator=(SmallVec const &amp;other)
    &#123;
        if (this == &amp;other)
            return *this;

        if (other.m_head == other.m_data.data())
        &#123;
            if (m_head != m_data.data())
            &#123;
                delete[] m_head;
                m_head = m_data.data();
            &#125;
            m_capacity = N;
            m_size = other.m_size;
        &#125;
        else
        &#123;
            if (m_capacity &lt; other.m_size)
            &#123;
                delete[] m_head;
                m_head = nullptr;
            &#125;
            if (m_head == nullptr || m_head == m_data.data())
            &#123;
                m_capacity = other.m_size;
                m_head = new T[m_capacity];
            &#125;
            m_size = other.m_size;
        &#125;

        std::copy_n(other.m_head, m_size, m_head);
        return *this;
    &#125;

    SmallVec &amp;operator=(SmallVec &amp;&amp;other) noexcept
    &#123;
        if (this == &amp;other)
            return *this;

        if (other.m_head == other.m_data.data())
        &#123;
            if (m_head != m_data.data())
            &#123;
                delete[] m_head;
                m_head = m_data.data();
            &#125;
            m_capacity = N;
            m_size = other.m_size;
            std::copy_n(other.m_head, m_size, m_head);
        &#125;
        else
        &#123;
            m_head = other.m_head;
            m_capacity = other.m_capacity;
            m_size = other.m_size;

            other.m_head = other.m_data.data();
            other.m_capacity = N;
            other.size = 0;
        &#125;

        return *this;
    &#125;

    void push_back(T const &amp;value)
    &#123;
        if (m_capacity == m_size)
        &#123;
            m_capacity *= 2;
            T *tmp = new T[m_capacity];
            std::copy_n(m_head, m_size, tmp);
            if (m_head != m_data.data())
            &#123;
                delete[] m_head;
            &#125;
            m_head = tmp;
        &#125;
        m_head[m_size++] = value;
    &#125;

    void pop_back()
    &#123;
        if (m_size == 0)
        &#123;
            throw std::runtime_error(&quot;small vector underflow&quot;);
        &#125;

        back().~T();
        m_size--;
    &#125;

    T const &amp;operator[](size_t it) const &#123; return m_head[it]; &#125;
    T &amp;operator[](size_t it) &#123; return m_head[it]; &#125;

    size_t size() noexcept &#123; return m_size; &#125;
    size_t capacity() noexcept &#123; return m_capacity; &#125;
    iterator begin() noexcept &#123; return m_head; &#125;
    iterator end() noexcept &#123; return m_head + m_size; &#125;
    const_iterator begin() const noexcept &#123; return m_head; &#125;
    const_iterator end() const noexcept &#123; return m_head + m_size; &#125;

    T const &amp;back() const &#123; return m_head[m_size - 1]; &#125;
    T &amp;back() &#123; return m_head[m_size - 1]; &#125;

    friend std::ostream &amp;operator&lt;&lt;(std::ostream &amp;os, const SmallVec &amp;sv)
    &#123;
        os &lt;&lt; '[';
        for (auto v : sv)
        &#123;
            os &lt;&lt; v &lt;&lt; ' ';
        &#125;
        os &lt;&lt; ']';
        return os;
    &#125;

    ~SmallVec()
    &#123;
        if (m_head != m_data.data() &amp;&amp; m_head != nullptr)
        &#123;
            delete[] m_head;
        &#125;
    &#125;

private:
    T *m_head = nullptr;
    size_t m_size = 0;
    size_t m_capacity = N;
    std::array&lt;T, N&gt; m_data;
&#125;;

int main()
&#123;
    // constructor, stack
    &#123;
        SmallVec&lt;int&gt; sv1;
        SmallVec&lt;int&gt; sv2(sv1);
        SmallVec&lt;int&gt; sv3(std::move(sv1));
        SmallVec&lt;int&gt; sv4 = sv3;
        SmallVec&lt;int&gt; sv5 = std::move(sv4);
    &#125;
    // constructor, heap
    &#123;
        SmallVec&lt;int&gt; sv1(20);
        SmallVec&lt;int&gt; sv2(sv1);
        SmallVec&lt;int&gt; sv3(std::move(sv1));
        SmallVec&lt;int&gt; sv4 = sv3;
        SmallVec&lt;int&gt; sv5 = std::move(sv4);
    &#125;
    // push_back
    &#123;
        SmallVec&lt;int&gt; sv1(3);
        std::cout &lt;&lt; sv1 &lt;&lt; std::endl;
        // [X, X, X], where X are arbitrary numbers

        for (int i = 0; i &lt; 11; i++)
        &#123;
            sv1.push_back(1);
        &#125;
        std::cout &lt;&lt; sv1 &lt;&lt; std::endl;
        // [X X X 1 1 1 1 1 1 1 1 1 1 ]
    &#125;
    // pop_back
    &#123;
        SmallVec&lt;int&gt; sv1(20);
        std::cout &lt;&lt; &quot;size: &quot; &lt;&lt; sv1.size() &lt;&lt; &quot;, capacity: &quot; &lt;&lt; sv1.capacity() &lt;&lt; std::endl;
        // size: 20, capacity: 20
        while (sv1.size())
        &#123;
            sv1.pop_back();
        &#125;
        std::cout &lt;&lt; &quot;size: &quot; &lt;&lt; sv1.size() &lt;&lt; &quot;, capacity: &quot; &lt;&lt; sv1.capacity() &lt;&lt; std::endl;
        // size: 0, capacity: 20
    &#125;
&#125;
</code></pre>
</details>

    </div>
    

    <a href="/books/beyond-just-coding-book.html" onclick="gtag('event', 'click_book_banner', {'link_url': this.href});">
        <picture>
            <!-- For screens wider than 600px -->
            <source media="(min-width: 600px)" srcset="/img/new-book-banner.png" class="new-book-banner-image">
            
            <!-- Default image for smaller screens -->
            <img src="/img/new-book-banner-small.png" alt="„ÄäÁ®ãÂºèË®≠Ë®àÂéü‰æÜ‰∏çÂè™ÊúâÂØ´ CODEÔºÅ„ÄãÊñ∞Êõ∏Ê©´ÂπÖÂª£Âëä" class="new-book-banner-image">
        </picture>
    </a>

   
    <div class="post-tag">
        tags:&nbsp;
        
            <a href="/en/tags/c/">
                c++
            </a>,&nbsp;
        
            <a href="/en/tags/small-vector/">
                small vector
            </a>,&nbsp;
        
            <a href="/en/tags/vector/">
                vector
            </a>,&nbsp;
        
            <a href="/en/tags/optimization/">
                optimization
            </a>,&nbsp;
        
    </div>
    
<script>
    hljs.configure({
        useBR: false
    });
    document.querySelectorAll('.code').forEach((block) => {
        hljs.highlightBlock(block);
    });
    document.querySelectorAll('pre code').forEach((block) => {
        hljs.highlightBlock(block);
    });
</script>

<p class="post-end-line-small">
    Â¶ÇÊûúÊÇ®Ë¶∫ÂæóÈÄôÁØáÊñáÁ´†ÊúâÂπ´Âä©ÔºåÊÇ®ÂèØ‰ª• <a href="/donation/">Ë¥äÂä©</a> ÈÄôÂÄãÁ∂≤Á´ôÔºÅ
    Ê≠§Â§ñ‰πüÂèØ‰ª•Âéª <a href="/message">ÂÖ®Á´ôÁïôË®ÄÊùø</a> ‰æÜÁïôË®ÄÂñîÔºÅ
</p>

        </main>
        <aside class="aside">
            <div class="close"></div>
            <section class="aside-section">
                
<h2>About Me</h2>
<img alt="my photo" width="80%" src="/img/selfie3.jpg">
<div class="about">
  Liu, An-Chi ÂäâÂÆâÈΩä<br>
  Software Engineer<br>
  @tigercosmos
</div>


            </section>
            <section class="aside-section">
                
    <h2>Êñ∞Êõ∏‰∏äÂ∏Ç</h2>
    <a href="/books/beyond-just-coding-book.html" onclick="gtag('event', 'click_book_side', {'link_url': this.href});">
        <img alt="Êñ∞Êõ∏Êé®Âª£Ôºö„ÄäÁ®ãÂºèË®≠Ë®àÂéü‰æÜ‰∏çÂè™ÊúâÂØ´ CODEÔºÅÈäúÊé•Â≠∏Ê†°ËàáËÅ∑Â†¥ÁöÑ‰∫îÂ†ÇËªüÈ´îÈñãÁôºÂØ¶ÁøíË™≤„Äã" width="100%" src="/img/new-book-banner-small.png">
    </a>

            </section>
            
                <section class="aside-section">
                    <h2>TOC</h2>
<div class="toc-container">
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#A-Simple-Small-Vector"><span class="toc-text">A Simple Small Vector</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A-Full-Small-Vector-Implementation"><span class="toc-text">A Full Small Vector Implementation</span></a></li></ol>
</div>
                </section>
            
            <section class="aside-section">
                
<div class="recent-post">
  <h2>Recent Posts</h2>
  <ul>
    
    
    
    <li>
      <a href="/en/post/2025/10/japan/find-swe-job-in-japan-2025/">
        My 2025 Fall Mid-Level SWE Job Hunt in Japan and Taiwan
      </a>
    </li>
    
    <li>
      <a href="/en/post/2025/06/software-engineer/software-engineer-grow-up-4/">
        New Software Engineer in Training (4): Promoted to Mid-Level Engineer, Quitting to Start a Company (Finale)
      </a>
    </li>
    
    <li>
      <a href="/en/post/2025/02/algorithm/bts-tree-delete/">
        Deleting a Node in a Binary Search Tree (LeetCode 450: Delete Node in a BST)
      </a>
    </li>
    
    <li>
      <a href="/en/post/2024/12/c++/hash/">
        An Introduction to std::hash in C++
      </a>
    </li>
    
    <li>
      <a href="/en/post/2024/11/c++/std-string-advanced/">
        C++ std::string Advanced: One Article to Get You Comfortable with Strings!
      </a>
    </li>
    
    <li>
      <a href="/en/post/2024/09/software-engineer/software-engineer-grow-up-3/">
        New Software Engineer in Training (3): Breakthrough Growth and Becoming an Open Source Maintainer
      </a>
    </li>
    
    <li>
      <a href="/en/post/2023/12/japan/learn-japanese-n4/">
        My Three-Month JLPT N4 Self-Study Experience
      </a>
    </li>
    
    <li>
      <a href="/en/post/2023/11/software-engineer/software-engineer-grow-up-2/">
        New Software Engineer in Training (2): Workplace Socialization and Survival
      </a>
    </li>
    
    <li>
      <a href="/en/post/2023/09/system/intel-gpu-opencl/">
        How to Run OpenCL on an Intel GPU
      </a>
    </li>
    
    <li>
      <a href="/en/post/2023/07/c++/template-for-std-containter-conversion/">
        Converting Between Container Types with C++ Template Functions (std::list&lt;int&gt; to std::vector&lt;double&gt;)
      </a>
    </li>
    
  </ul>
</div>


            </section>
            <section class="aside-section">
                
<h2>Search</h2>
<input class="search-input" type="text" placeholder="Search on Google">
<script>
    const input = document.getElementsByClassName("search-input");
    input[0].addEventListener("keyup", function (event) {
        if (event.keyCode === 13) {
            event.preventDefault();
            window.open("https://www.google.com/search?&q=site%3Atigercosmos.xyz+" + input[0].value);
        }
    });
</script>

            </section>
            <section class="aside-section">
                <div>
     <h2>Ë¥äÂä©ÂØ´‰Ωú</h2>
     Ë¨ùË¨ùÊÇ®ÁöÑÂçîÂä©ÔºåË´ã‰ΩúËÄÖÂñù‰∏ÄÊùØÂíñÂï°ÔºåËÉΩËÆì‰ΩúËÄÖÁî®‰æÜÊõ¥ÊúâÂãïÂäõÁÇ∫ËÆÄËÄÖÊèê‰æõÂìÅË≥™Êõ¥Âä†ÂÑ™ËâØÁöÑÊñáÁ´†ËàáÈñ±ËÆÄÁí∞Â¢É
     <div align="center">
          <a href='/donation'><img
                    src="https://user-images.githubusercontent.com/18013815/79032455-21002a00-7bd9-11ea-920f-354c6133cc2a.png"
                    width="80%"></a>
     </div>
</div>
            </section>
            <section class="aside-section">
                
    <h2>Archives</h2>

    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/en/archives/2025/">2025</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/en/archives/2024/">2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/en/archives/2023/">2023</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/en/archives/2022/">2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/en/archives/2021/">2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/en/archives/2020/">2020</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/en/archives/2019/">2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/en/archives/2018/">2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/en/archives/2017/">2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/en/archives/2016/">2016</a><span class="archive-list-count">2</span></li></ul>


            </section>
            <section class="aside-section tag">
                
    <h2>Tags</h2>

    <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/ai/" rel="tag">ai</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/algorithm/" rel="tag">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/amd-mi50/" rel="tag">amd mi50</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/art/" rel="tag">art</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/atmospheric-sciences/" rel="tag">atmospheric sciences</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/atomic/" rel="tag">atomic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/benchmark/" rel="tag">benchmark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/bias/" rel="tag">bias</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/bime/" rel="tag">bime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/binary-search-tree/" rel="tag">binary search tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/c/" rel="tag">c++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/cmake/" rel="tag">cmake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/company/" rel="tag">company</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/compare-and-swap/" rel="tag">compare and swap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/computer-animation/" rel="tag">computer animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/computer-science/" rel="tag">computer science</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/computer-vision/" rel="tag">computer vision</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/condition-variable/" rel="tag">condition variable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/courses/" rel="tag">courses</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/cpu/" rel="tag">cpu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/cublas/" rel="tag">cublas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/cuda/" rel="tag">cuda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/cudnn/" rel="tag">cudnn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/data-structures/" rel="tag">data structures</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/debug/" rel="tag">debug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/deep-learning/" rel="tag">deep learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/elixir/" rel="tag">elixir</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/english/" rel="tag">english</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/fine-arts-club/" rel="tag">fine arts club</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/floating-point-number/" rel="tag">floating-point number</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/gdb/" rel="tag">gdb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/googlenet/" rel="tag">googlenet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/googletest/" rel="tag">googletest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/gpu/" rel="tag">gpu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/graduate-school/" rel="tag">graduate school</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/hash/" rel="tag">hash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/header-only/" rel="tag">header-only</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/http-server/" rel="tag">http server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/%E2%80%8Eieee-754/" rel="tag">‚Äéieee 754</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/intel/" rel="tag">intel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/japan/" rel="tag">japan</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/japanese/" rel="tag">japanese</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/jlpt/" rel="tag">jlpt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/job/" rel="tag">job</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/language-learning/" rel="tag">language learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/leetcode-450/" rel="tag">leetcode 450</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/lock-free/" rel="tag">lock free</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/master-s/" rel="tag">master's</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/measurement/" rel="tag">measurement</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/nchc/" rel="tag">nchc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/nctu-observations-and-reflections/" rel="tag">nctu observations and reflections</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/network/" rel="tag">network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/network-analysis/" rel="tag">network analysis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/new-software-engineer-in-training/" rel="tag">new software engineer in training</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/nlp/" rel="tag">nlp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/note/" rel="tag">note</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/ntu/" rel="tag">ntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/ntu-observations-and-reflections/" rel="tag">ntu observations and reflections</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/nycu-icse/" rel="tag">nycu icse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/open-source/" rel="tag">open source</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/open-source-projects/" rel="tag">open source projects</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/opencl/" rel="tag">opencl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/optimization/" rel="tag">optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/parallel-programming/" rel="tag">parallel programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/pcap/" rel="tag">pcap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/pcapplusplus/" rel="tag">pcapplusplus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/perf/" rel="tag">perf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/programming/" rel="tag">programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/projects/" rel="tag">projects</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/promiscuous-mode/" rel="tag">promiscuous mode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/pytorch/" rel="tag">pytorch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/red-black-tree/" rel="tag">red black tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/reentrancy/" rel="tag">reentrancy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/rust/" rel="tag">rust</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/servo/" rel="tag">servo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/small-vector/" rel="tag">small vector</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/software-engineer/" rel="tag">software engineer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/spec-accel/" rel="tag">spec accel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/spec-cpu/" rel="tag">spec cpu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/sso/" rel="tag">sso</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/startup/" rel="tag">startup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/std-hash/" rel="tag">std::hash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/std-unordered-map/" rel="tag">std::unordered_map</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/std-unordered-set/" rel="tag">std::unordered_set</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/string/" rel="tag">string</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/string-view/" rel="tag">string_view</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/system/" rel="tag">system</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/system-software/" rel="tag">system software</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/t2/" rel="tag">t2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/taiwan/" rel="tag">taiwan</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/teaching-assistant/" rel="tag">teaching assistant</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/template/" rel="tag">template</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/tensorflow/" rel="tag">tensorflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/thoughts/" rel="tag">thoughts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/thread-safe/" rel="tag">thread-safe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/tokyo/" rel="tag">tokyo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/unit-test/" rel="tag">unit test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/university/" rel="tag">university</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/vector/" rel="tag">vector</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/vgg16/" rel="tag">vgg16</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/work/" rel="tag">work</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/xr-project/" rel="tag">xr project</a></li><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/%E6%95%88%E8%83%BD%E5%88%86%E6%9E%90/" rel="tag">ÊïàËÉΩÂàÜÊûê</a></li></ul>


            </section>
        </aside>
    </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>

</html>
